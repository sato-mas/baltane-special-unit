var FAV_TABLES = {
  "dai": [
    [-1,-1,1,0,0,2], [0,0,-1,-1,2,1], [-1,-1,1,0,0,0], [0,0,-1,-1,1,0], [0,1,0,0,-1,-1],
    [-1,-1,1,0,0,0], [-1,-1,1,0,0,0], [0,0,1,0,-1,-1], [-1,-1,1,0,0,0], [0,0,0,1,-1,-1],
    [-1,-1,1,0,0,0], [0,1,0,0,-1,-1], [0,0,1,0,-1,-1], [0,0,-1,-1,0,1], [1,0,0,0,-1,-1],
    [0,0,-1,-1,0,1], [-1,-1,0,0,1,0], [-1,-1,1,0,0,0], [-1,-1,1,0,0,0], [0,0,0,1,-1,-1],
    [-1,-1,0,0,1,0], [-1,-1,1,0,0,0], [-1,-1,1,0,0,0], [-1,-1,0,0,1,0], [0,0,-1,-1,1,0],
    [-1,-1,0,1,0,0], [-1,-1,0,0,1,0], [-1,-1,1,0,0,0], [0,0,0,1,-1,-1], [1,0,-1,-1,0,0],
    [-1,-1,0,0,0,1], [-1,-1,1,0,0,0], [0,0,0,1,-1,-1], [0,0,1,0,-1,-1], [-1,-1,0,0,1,0],
    [0,0,-1,-1,1,0], [0,0,0,1,-1,-1], [-1,-1,1,0,0,0], [0,0,-1,-1,1,0], [0,1,0,0,-1,-1],
    [-1,-1,1,0,0,0], [0,0,-1,-1,1,0], [-1,-1,1,0,0,0], [0,0,-1,-1,0,1], [1,0,-1,-1,0,0],
    [0,0,-1,-1,0,1], [0,0,1,0,-1,-1], [0,0,-1,-1,0,1], [0,0,1,0,-1,-1], [-1,-1,0,0,1,0],
    [-1,-1,0,1,0,0], [0,0,-1,-1,1,0], [0,0,-1,-1,1,0], [-1,-1,1,0,0,0], [-1,-1,0,0,1,0],
    [0,1,-1,-1,0,0], [0,1,0,0,-1,-1], [0,0,1,0,-1,-1], [0,0,1,0,-1,-1], [0,0,1,0,-1,-1],
    [-1,-1,1,0,0,0], [0,0,1,0,-1,-1], [-1,-1,0,0,1,0], [0,1,0,0,-1,-1], [0,0,0,1,-1,-1],
    [-1,-1,0,0,1,0], [0,0,1,0,-1,-1], [-1,-1,0,0,1,0], [0,0,1,0,-1,-1], [-1,-1,0,0,1,0],
    [0,0,1,0,-1,-1], [0,1,-1,-1,0,0], [-1,-1,1,0,0,0], [1,0,0,0,-1,-1], [0,0,0,1,-1,-1],
    [0,0,1,0,-1,-1], [0,1,-1,-1,0,0], [-1,-1,1,0,0,0], [-1,-1,0,0,1,0], [0,0,1,0,-1,-1],
    [1,0,-1,-1,0,0], [0,0,-1,-1,0,1], [0,1,0,0,-1,-1], [-1,-1,0,0,0,1], [-1,-1,0,0,1,0],
    [1,0,-1,-1,0,0], [-1,-1,0,0,1,0], [-1,-1,0,0,0,1], [0,0,-1,-1,1,0], [1,0,0,0,-1,-1],
    [0,0,-1,-1,1,0], [-1,-1,0,1,0,0], [0,0,1,0,-1,-1], [0,0,-1,-1,1,0], [0,0,0,1,-1,-1],
    [-1,-1,0,0,0,1], [0,0,-1,-1,1,0],
  ],
  "eyrlys": [
    [1,0,0,2,-1,0], [2,0,1,0,0,0], [0,0,0,1,-1,0], [-1,0,1,0,0,0], [1,-1,0,0,0,0],
    [-1,1,0,-1,0,0], [1,0,0,0,0,-1], [1,0,0,0,-1,0], [0,1,-1,-1,0,0], [1,0,-1,0,0,0],
    [0,1,-1,0,0,0], [-1,0,0,-1,1,0], [0,1,0,0,0,-1], [0,1,0,-1,0,0], [0,-1,0,1,-1,0],
    [-1,0,0,0,-1,1], [0,1,-1,0,0,0], [0,-1,0,-1,1,0], [1,0,-1,0,0,0], [0,1,-1,0,0,0],
    [-1,-1,0,0,0,1], [0,0,-1,0,1,-1], [-1,0,0,-1,0,1], [0,0,0,-1,-1,1], [-1,0,-1,1,0,0],
    [-1,1,0,0,0,0], [0,0,0,1,0,-1], [-1,0,1,0,0,-1], [0,-1,-1,0,1,0], [0,-1,0,0,1,0],
    [1,0,0,-1,0,0], [1,0,0,-1,0,0], [1,0,0,0,-1,0], [-1,1,0,0,0,0], [-1,1,0,0,0,-1],
    [-1,1,-1,0,0,0], [1,0,-1,0,0,-1], [0,-1,0,1,0,0], [1,-1,0,0,0,0], [1,0,0,-1,0,0],
    [0,0,-1,1,0,0], [0,-1,1,0,0,0], [0,0,1,-1,0,0], [-1,1,0,0,0,0], [0,0,-1,1,0,0],
    [0,0,1,0,0,-1], [-1,-1,0,1,0,0], [0,-1,-1,1,0,0], [1,0,-1,0,0,0], [0,0,-1,1,0,-1],
    [0,1,0,0,-1,0], [1,0,0,-1,0,0], [1,0,-1,0,0,0], [0,1,0,-1,0,0], [-1,1,0,-1,0,0],
    [0,0,-1,-1,0,1], [-1,0,0,0,0,1], [1,0,0,0,-1,0], [-1,1,0,0,0,0], [0,-1,0,1,-1,0],
    [-1,0,1,0,0,0], [-1,-1,0,0,1,0], [-1,1,0,0,-1,0], [-1,1,0,-1,0,0], [0,0,-1,1,-1,0],
    [1,0,0,-1,0,0], [0,1,0,0,-1,0], [1,0,0,0,0,-1], [1,0,0,0,-1,0], [1,0,0,-1,0,0],
    [0,-1,1,0,0,-1], [-1,1,0,0,-1,0], [-1,1,0,0,0,0], [0,0,1,0,-1,0], [-1,1,0,0,0,-1],
    [1,0,0,0,0,-1], [-1,1,0,0,0,0], [1,-1,0,0,0,0], [-1,1,0,0,0,0], [0,0,0,-1,1,0],
    [1,0,0,0,-1,0], [-1,1,0,-1,0,0], [-1,-1,0,1,0,0], [1,0,0,0,0,-1], [0,-1,0,0,1,0],
    [-1,-1,1,0,0,0], [-1,1,0,0,0,-1], [0,1,0,0,0,-1], [-1,0,0,1,0,0], [0,0,0,1,0,-1],
    [1,0,0,0,0,-1], [0,1,0,0,0,-1], [-1,0,-1,1,0,0], [1,0,0,0,0,-1], [1,0,0,0,-1,-1],
    [0,0,-1,-1,0,1], [0,-1,0,1,0,0]
  ],
  "kaoru": [
    [0,0,1,0,0,2], [0,0,1,0,2,0], [0,1,0,0,0,0], [0,0,0,1,0,0], [0,0,1,0,0,0],
    [0,0,0,0,0,1], [0,1,0,0,0,0], [0,0,0,1,0,0], [0,0,0,0,0,1], [0,0,0,1,0,0],
    [1,0,0,0,0,0], [1,0,0,0,0,0], [0,0,0,0,1,0], [0,0,0,0,0,1], [0,0,0,1,0,0],
    [0,0,0,0,1,0], [0,0,0,0,0,1], [1,0,0,0,0,0], [1,0,0,0,0,0], [1,0,0,0,0,0],
    [0,0,0,0,1,0], [0,0,0,0,0,1], [1,0,0,0,0,0], [0,0,0,0,1,0], [0,0,1,0,0,0],
    [1,0,0,0,0,0], [0,0,0,0,1,0], [0,1,0,0,0,0], [0,0,0,0,0,1], [1,0,0,0,0,0],
    [1,0,0,0,0,0], [0,0,1,0,0,0], [0,0,0,0,0,1], [1,0,0,0,0,0], [0,0,0,0,1,0],
    [1,0,0,0,0,0], [0,1,0,0,0,0], [0,1,0,0,0,0], [0,1,0,0,0,0], [0,0,1,0,0,0],
    [0,1,0,0,0,0], [0,0,0,0,0,1], [0,0,0,0,1,0], [0,0,0,1,0,0], [0,1,0,0,0,0],
    [0,0,1,0,0,0], [0,0,0,0,1,0], [0,0,0,0,0,1], [0,0,1,0,0,0], [0,0,0,0,0,1],
    [0,0,0,1,0,0], [1,0,0,0,0,0], [0,0,1,0,0,0], [0,0,0,0,1,0], [0,0,0,1,0,0],
    [0,0,0,1,0,0], [0,0,0,1,0,0], [0,0,0,0,1,0], [0,0,0,0,1,0], [0,0,1,0,0,0],
    [0,0,1,0,0,0], [0,1,0,0,0,0], [0,0,0,0,1,0], [0,1,0,0,0,0], [1,0,0,0,0,0],
    [0,1,0,0,0,0], [0,0,0,1,0,0], [0,0,0,0,0,1], [0,0,0,0,1,0], [0,1,0,0,0,0],
    [0,0,1,0,0,0], [0,0,0,0,1,0], [0,0,0,0,0,1], [0,1,0,0,0,0], [1,0,0,0,0,0],
    [1,0,0,0,0,0], [0,0,0,1,0,0], [1,0,0,0,0,0], [1,0,0,0,0,0], [0,0,0,0,1,0],
    [0,0,0,1,0,0], [0,0,0,1,0,0], [0,1,0,0,0,0], [0,0,0,0,1,0], [0,0,0,1,0,0],
    [0,0,0,0,0,1], [1,0,0,0,0,0], [0,0,0,0,1,0], [0,0,0,0,0,1], [0,0,0,1,0,0],
    [0,0,0,0,0,1], [0,0,0,0,1,0], [0,0,0,0,0,1], [0,1,0,0,0,0], [1,0,0,0,0,0],
    [0,0,0,1,0,0], [0,1,0,0,0,0]
  ],
  "elsie": [
    [0,0,0,1,0,0], [2,0,1,0,0,0], [0,0,0,0,1,0], [0,0,0,0,0,1], [0,0,0,0,1,0],
    [0,0,1,0,0,0], [0,0,0,0,0,1], [0,0,0,0,0,1], [0,0,1,0,0,0], [1,0,0,0,0,0],
    [0,1,0,0,0,0], [0,0,1,0,0,0], [0,0,0,0,0,1], [0,0,1,0,0,0], [0,1,0,0,0,0],
    [0,0,1,0,0,0], [1,0,0,0,0,0], [0,0,0,1,0,0], [0,0,1,0,0,0], [0,0,1,0,0,0],
    [0,0,1,0,0,0], [0,0,0,0,0,1], [0,0,1,0,0,0], [0,0,0,1,0,0], [0,0,1,0,0,0],
    [0,0,0,0,0,1], [1,0,0,0,0,0], [0,0,0,0,1,0], [0,0,1,0,0,0], [0,0,1,0,0,0],
    [0,0,1,0,0,0], [0,0,0,0,0,1], [0,0,0,1,0,0], [0,0,0,0,0,1], [0,1,0,0,0,0],
    [0,0,0,0,0,1], [0,0,1,0,0,0], [0,0,0,1,0,0], [1,0,0,0,0,0], [0,1,0,0,0,0],
    [0,0,1,0,0,0], [0,0,1,0,0,0], [1,0,0,0,0,0], [0,0,0,0,0,1], [0,0,0,1,0,0],
    [0,0,0,0,0,1], [0,0,0,1,0,0], [0,0,1,0,0,0], [0,0,1,0,0,0], [0,0,0,0,0,1],
    [0,0,1,0,0,0], [0,1,0,0,0,0], [0,0,0,0,0,1], [0,0,1,0,0,0], [1,0,0,0,0,0],
    [0,0,1,0,0,0], [0,0,1,0,0,0], [0,0,1,0,0,0], [0,0,0,0,1,0], [0,0,0,0,0,1],
    [0,0,1,0,0,0], [0,0,1,0,0,0], [1,0,0,0,0,0], [0,1,0,0,0,0], [0,0,0,0,0,1],
    [0,0,0,0,0,1], [0,0,1,0,0,0], [0,0,1,0,0,0], [0,0,1,0,0,0], [0,0,0,0,1,0],
    [0,0,1,0,0,0], [0,1,0,0,0,0], [0,0,0,1,0,0], [0,0,1,0,0,0], [0,0,0,0,1,0],
    [0,0,1,0,0,0], [0,0,0,0,1,0], [0,0,0,0,0,1], [1,0,0,0,0,0], [0,0,1,0,0,0],
    [0,0,1,0,0,0], [0,0,0,0,0,1], [0,1,0,0,0,0], [0,0,1,0,0,0], [0,0,1,0,0,0],
    [0,0,0,0,1,0], [0,0,0,0,0,1], [1,0,0,0,0,0], [1,0,0,0,0,0], [0,0,0,0,1,0],
    [0,0,0,0,1,0], [0,0,0,0,1,0], [0,0,0,0,1,0], [0,0,0,0,0,1], [0,0,1,0,0,0],
    [0,0,1,0,0,0], [1,0,0,0,0,0]
  ]
}

var CHARACTERS = ["dai", "eyrlys", "elsie", "kaoru"]

function normalize_index(character_name, index) {
  if (index < 0)
    return FAV_TABLES[character_name].length + index % FAV_TABLES[character_name].length
  return index % FAV_TABLES[character_name].length
}

function get_default_index(name) {
  if (localStorage.getItem(name+"-index"))
    return parseInt(localStorage.getItem(name+"-index"))
  return 0;
}

$(function(){
  // initialize_table
  function create_table(name, index) {
    var ractive = new Ractive({
      el: "#"+name+"-table",
      template: "#template",
      data: {
        character: name,
        index: index,
        table: FAV_TABLES[name],
        normalize_index: function(num){
          return normalize_index(this.get().character, num);
        },
        get_fav: function(num) {
          var idx = normalize_index(this.get().character, num);
          return FAV_TABLES[this.get().character][idx]
        },
      }
    });

    ractive.on('-3', function(event){
      var idx = normalize_index(ractive.get().character, ractive.get().index - 3);
      localStorage.setItem(ractive.get().character+"-index", idx)
      ractive.set('index', idx);
    });
    ractive.on('-1', function(event){
      var idx = normalize_index(ractive.get().character, ractive.get().index - 1);
      localStorage.setItem(ractive.get().character+"-index", idx)
      ractive.set('index', idx);
    });
    ractive.on('+1', function(event){
      var idx = normalize_index(ractive.get().character, ractive.get().index + 1);
      localStorage.setItem(ractive.get().character+"-index", idx)
      ractive.set('index', idx);
    });
    ractive.on('+3', function(event){
      var idx = normalize_index(ractive.get().character, ractive.get().index + 3);
      localStorage.setItem(ractive.get().character+"-index", idx)
      ractive.set('index', idx);
    });
    ractive.on('show-complete-fav-table', function(event){
      var character = ractive.get().character
      var idx = normalize_index(character, ractive.get().index);
      ractive.set({'index': idx,
                   'character': character,
                   'table': FAV_TABLES[character]});
    });
  }
  for (var i=0; i < CHARACTERS.length; i++) {
    create_table(CHARACTERS[i], get_default_index(CHARACTERS[i]));
  }


});
